function Banners(){}Banners.prototype.listenAddBannerEvent=function(){var n=this;$("#add-banner-btn").click(function(){6<=$(".banner-list-group").children().length?window.messageBox.showInfo("最多只能添加6张轮播图"):n.createBannerItem()})},Banners.prototype.createBannerItem=function(n){var e=this,a=template("banner-item",{banner:n}),t=$(".banner-list-group"),r=null,r=n?(t.append(a),t.find(".banner-item:last")):(t.prepend(a),t.find(".banner-item:first"));e.addImageSelectEvent(r),e.addRemoveBannerEvent(r),e.addSaveBannerEvent(r)},Banners.prototype.addImageSelectEvent=function(n){var a=n.find(".thumbnail"),e=n.find(".image-input");a.click(function(){e.click()}),e.change(function(){var n=this.files[0],e=new FormData;e.append("file",n),xfzajax.post({url:"/cms/upload_file/",data:e,processData:!1,contentType:!1,success:function(n){var e;200==n.code&&(e=n.data.url,a.attr("src",e))}})})},Banners.prototype.addRemoveBannerEvent=function(e){e.find(".banner-close-btn").click(function(){var n=e.attr("data-banner-id");n?xfzalert.alertConfirm({text:"您确定要删除这个轮播图吗?",confirmCallback:function(){xfzajax.post({url:"/cms/delete_banner/",data:{banner_id:n},success:function(n){200===n.code&&(e.remove(),window.messageBox.showSuccess("轮播图删除才成功！"))}})}}):e.remove()})},Banners.prototype.addSaveBannerEvent=function(r){var n=r.find(".banner-save-btn"),i=r.find(".thumbnail"),o=r.find('input[name="priority"]'),s=r.find('input[name="link_to"]'),c=r.attr("data-banner-id"),d="",d=c?"/cms/edit_banner/":"/cms/add_banner/";n.click(function(){var n=i.attr("src"),e=o.val(),a=s.val(),t=r.find('span[class="priority"]');xfzajax.post({url:d,data:{image_url:n,priority:e,link_to:a,pk:c},success:function(n){200==n.code&&(c?window.messageBox.showSuccess("轮播图修改成功"):(c=n.data.banner_id,console.log(c),r.attr("data-banner-id",c),window.messageBox.showSuccess("轮播图添加完成")),t.text("优先级: "+e))}})})},Banners.prototype.loadData=function(){var r=this;xfzajax.get({url:"/cms/banner_list/",success:function(n){if(200==n.code)for(var e=n.data,a=0;a<e.length;a++){var t=e[a];r.createBannerItem(t)}}})},Banners.prototype.run=function(){this.listenAddBannerEvent(),this.loadData()},$(function(){(new Banners).run()});